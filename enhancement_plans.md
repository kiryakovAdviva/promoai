# План улучшений RAG системы

## 1. Multi-step RAG
- [x] Реализовать двухэтапный поиск
  - [x] Первый этап: широкий поиск (top_k=50)
  - [x] Второй этап: уточняющий поиск в контексте
  - [x] Интеграция с существующим поиском
  - [x] Тестирование на реальных запросах
- [x] Добавлен анализ результатов поиска
- [x] Интегрирован в LLM клиент

## 2. Reranking
- [x] Добавить переранжирование результатов
  - [x] Интеграция cross-encoder модели
  - [x] Настройка весов для разных типов документов
  - [x] Оптимизация производительности
  - [x] Тестирование качества ранжирования
- [x] Оптимизация reranking
  - [x] Добавить кэширование результатов
  - [x] Уменьшить initial_top_k до 30
  - [x] Оптимизировать обработку больших документов

## 3. Улучшение чанкинга
- [ ] Специальные типы чанков
  - [ ] Чанки для ссылок (URL)
  - [ ] Чанки для контактной информации
  - [ ] Чанки для SLA и метрик
  - [ ] Чанки для процессов и регламентов
- [ ] Улучшение обработки контента
  - [ ] Сохранение структуры документов
  - [ ] Извлечение и сохранение метаданных
  - [ ] Обработка таблиц и списков
  - [ ] Сохранение форматирования
- [ ] Оптимизация размера чанков
  - [ ] Адаптивный размер чанков
  - [ ] Умное разделение по смысловым блокам
  - [ ] Сохранение контекста между чанками

## 4. Обработка специальных типов данных
- [ ] Обработка ссылок
  - [ ] Извлечение URL из текста
  - [ ] Валидация и нормализация ссылок
  - [ ] Приоритизация в поиске
  - [ ] Сохранение контекста ссылок
- [ ] Обработка контактов
  - [ ] Структурированный формат контактов
  - [ ] Валидация email и других данных
  - [ ] Извлечение контактов из текста
  - [ ] Обновление контактной информации
- [ ] Обработка SLA
  - [ ] Формат для SLA информации
  - [ ] Извлечение временных метрик
  - [ ] Поиск по SLA запросам
  - [ ] Агрегация SLA данных

## 5. Улучшение ответов
- [x] Улучшение промптов
  - [x] Добавление требований к ответам
  - [x] Указание источников
  - [x] Структурирование ответов
  - [x] Тестирование качества

## 6. Мониторинг и метрики
- [x] Добавление метрик качества
  - [x] Отслеживание точности
  - [x] Анализ ошибок
  - [x] Сбор обратной связи
  - [x] Визуализация результатов

## Текущий прогресс
- [x] Создание ветки для улучшений
- [x] Документирование планов
- [x] Реализация Multi-step RAG
- [x] Улучшение системного промпта
- [x] Добавление reranking
- [x] Оптимизация reranking (кэширование, уменьшение initial_top_k, обработка больших документов)

## Заметки
- Базовая версия сохранена в ветке `feat/encryption-layer`
- Все улучшения реализуются в ветке `feat/enhanced-rag`
- Следующий шаг: реализация специальных типов чанков 